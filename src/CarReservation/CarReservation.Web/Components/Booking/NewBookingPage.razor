@inherits ViewBase<NewBookingViewModel>

@attribute [Route(UriCollection.Booking.New)]

@inject IStringLocalizer<Resources> Localizer

<Title Value="@(ViewModel.IsSuccess ? Localizer[nameof(Resources.Book_Confirmed)] : Localizer[nameof(Resources.Book_New_Title)])" />

<Alert IsVisible=@ViewModel.IsError
       Severity="Severity.Error">
    @Localizer[nameof(Resources.Book_UnableToComplete)]
</Alert>

<Alert IsVisible=@ViewModel.IsSuccess
       Severity="Severity.Success">
    @Localizer[nameof(Resources.Booking_Successful)]
</Alert>

<MudGrid>
    <CascadingValue Value="ViewModel">
        <Loader IsLoading=@(!ViewModel.IsInitialized || ViewModel.IsBusy)>
            <NewBookingForm />
        </Loader>
    </CascadingValue>
</MudGrid>



@code
{
    [SupplyParameterFromQuery(Name = UriCollection.Booking.Parameters.CarId)]
    public Guid? CarId { get; set; }

    [SupplyParameterFromQuery(Name = UriCollection.Booking.Parameters.From)]
    public DateTime? From { get; set; }

    [SupplyParameterFromQuery(Name = UriCollection.Booking.Parameters.Till)]
    public DateTime? Till { get; set; }

    protected override Task InitializeViewModelAsync() => Task.CompletedTask;

    protected override async Task OnParametersSetAsync()
    {
        await ViewModel.InitializeAsync(CarId, From, Till);
    }
}
